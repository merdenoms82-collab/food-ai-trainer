<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DarsNest | AI Kitchen OS</title>
    
    <!-- PWA Configuration -->
    <meta name="theme-color" content="#22c55e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DarsNest">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- TensorFlow.js and COCO-SSD -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
    
    <!-- iOS Splash Screens -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç≥</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== ENHANCED STYLES WITH TENSORFLOW INTEGRATION ===== */
        :root {
            --primary: #22c55e;
            --primary-gradient: linear-gradient(135deg, #22c55e 0%, #3b82f6 100%);
            --secondary-gradient: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --info-gradient: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            
            --glass-bg: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-blur: 20px;
            --glass-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --radius-full: 9999px;
            
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bouncy: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            -webkit-font-smoothing: antialiased;
        }
        
        .app-shell {
            width: 100vw;
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Liquid Background */
        .liquid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        
        .liquid-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.15;
            background: radial-gradient(circle, rgba(34, 197, 94, 0.2) 0%, rgba(59, 130, 246, 0.15) 100%);
        }
        
        .blob-1 {
            width: 400px;
            height: 400px;
            top: -100px;
            left: -100px;
            animation: floatY 25s infinite ease-in-out;
        }
        
        .blob-2 {
            width: 500px;
            height: 500px;
            bottom: -150px;
            right: -100px;
            animation: floatY 20s infinite ease-in-out reverse;
        }
        
        @keyframes floatY {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(40px); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        /* Glass Effect */
        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            position: relative;
            overflow: hidden;
            box-shadow: var(--glass-shadow);
        }
        
        /* Header */
        .app-header {
            height: 70px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(15, 23, 42, 0.7);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 44px;
            height: 44px;
            background: var(--primary-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            animation: pulse 3s infinite ease-in-out;
        }
        
        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .header-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Tab Bar */
        .tab-bar {
            height: 75px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom, 0px);
            position: relative;
            z-index: 100;
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: var(--transition-smooth);
            position: relative;
        }
        
        .tab-item.active {
            color: white;
        }
        
        .tab-icon {
            font-size: 1.4rem;
            margin-bottom: 6px;
            transition: var(--transition-bouncy);
        }
        
        .tab-item.active .tab-icon {
            transform: translateY(-6px);
        }
        
        .tab-badge {
            position: absolute;
            top: 10px;
            right: calc(50% - 25px);
            background: var(--danger-gradient);
            color: white;
            font-size: 10px;
            font-weight: 800;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            border: 2px solid rgba(15, 23, 42, 0.8);
            animation: pulse 2s infinite;
        }
        
        /* Pages */
        .page-container {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            transform: translateX(100%);
            opacity: 0;
            visibility: hidden;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
            padding-bottom: 80px;
        }
        
        .page.active {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }
        
        /* ===== HOME PAGE ===== */
        .home-page {
            padding: 20px;
        }
        
        .welcome-card {
            background: linear-gradient(135deg, 
                rgba(34, 197, 94, 0.25), 
                rgba(59, 130, 246, 0.2));
            margin-bottom: 24px;
            padding: 24px;
            animation: slideUp 0.6s ease-out;
        }
        
        .welcome-card h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .welcome-card p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .action-card {
            min-height: 110px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-bouncy);
            animation: slideUp 0.6s ease-out;
        }
        
        .action-card:nth-child(1) { animation-delay: 0.1s; }
        .action-card:nth-child(2) { animation-delay: 0.2s; }
        .action-card:nth-child(3) { animation-delay: 0.3s; }
        .action-card:nth-child(4) { animation-delay: 0.4s; }
        
        .action-card:hover {
            transform: translateY(-8px);
        }
        
        .action-card:active {
            transform: translateY(-2px);
        }
        
        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .action-icon::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        .action-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }
        
        .action-subtitle {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .stat-card:active {
            transform: scale(0.95);
        }
        
        .stat-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            color: white;
            font-size: 0.9rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 4px;
            font-family: 'Poppins', sans-serif;
        }
        
        .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Pantry Preview */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .view-all-btn {
            padding: 8px 16px;
            background: rgba(34, 197, 94, 0.2);
            color: var(--primary);
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition-smooth);
        }
        
        .view-all-btn:active {
            transform: scale(0.95);
        }
        
        .pantry-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .pantry-item {
            padding: 16px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .pantry-item:active {
            transform: scale(0.98);
        }
        
        .item-category {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(34, 197, 94, 0.3);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .item-name {
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .item-details {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 12px;
        }
        
        .expiry-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .expiry-fill {
            height: 100%;
            border-radius: 3px;
            position: relative;
        }
        
        .expiry-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        /* AI Progress */
        .ai-progress {
            margin-top: 32px;
            padding: 24px;
            background: linear-gradient(135deg, 
                rgba(139, 92, 246, 0.2), 
                rgba(236, 72, 153, 0.15));
        }
        
        .progress-value {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 8px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: 'Poppins', sans-serif;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 5px;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        /* ===== PANTRY PAGE ===== */
        .pantry-page {
            padding: 20px;
        }
        
        .pantry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .search-bar {
            flex: 1;
            height: 48px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .search-bar i {
            opacity: 0.6;
        }
        
        .search-input {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            flex: 1;
            outline: none;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .add-item-btn {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            background: var(--primary-gradient);
            color: white;
            border: none;
            margin-left: 12px;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .add-item-btn:active {
            transform: scale(0.95);
        }
        
        .pantry-categories {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 24px;
            padding-bottom: 8px;
        }
        
        .category-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .category-tab.active {
            background: var(--primary-gradient);
        }
        
        .pantry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
        }
        
        .pantry-card {
            padding: 20px;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
        }
        
        .pantry-card:active {
            transform: scale(0.98);
        }
        
        .pantry-card-low {
            border-left: 4px solid #f59e0b;
        }
        
        .pantry-card-expired {
            border-left: 4px solid #ef4444;
        }
        
        .pantry-card-fresh {
            border-left: 4px solid #22c55e;
        }
        
        .item-image {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 16px;
        }
        
        .item-status {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-fresh {
            background: #22c55e;
        }
        
        .status-warning {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }
        
        .status-expired {
            background: #ef4444;
            animation: pulse 1s infinite;
        }
        
        .item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
        }
        
        .quantity-btn {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .quantity-btn:active {
            transform: scale(0.9);
        }
        
        /* ===== SCANNER PAGE ===== */
        .scanner-page {
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        
        .scanner-viewport {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        #scannerVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror for selfie view */
        }
        
        .scanner-frame {
            width: 280px;
            height: 280px;
            border: 3px solid var(--primary);
            border-radius: 24px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            pointer-events: none;
        }
        
        .scanner-corner {
            position: absolute;
            width: 30px;
            height: 30px;
            border-color: var(--primary);
            border-width: 5px;
        }
        
        .corner-tl {
            top: 0;
            left: 0;
            border-top-style: solid;
            border-left-style: solid;
            border-top-left-radius: 20px;
        }
        
        .corner-tr {
            top: 0;
            right: 0;
            border-top-style: solid;
            border-right-style: solid;
            border-top-right-radius: 20px;
        }
        
        .corner-bl {
            bottom: 0;
            left: 0;
            border-bottom-style: solid;
            border-left-style: solid;
            border-bottom-left-radius: 20px;
        }
        
        .corner-br {
            bottom: 0;
            right: 0;
            border-bottom-style: solid;
            border-right-style: solid;
            border-bottom-right-radius: 20px;
        }
        
        .scanner-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            animation: scan 2s infinite linear;
            z-index: 11;
            pointer-events: none;
        }
        
        .scanner-controls {
            padding: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
        }
        
        .scan-btn {
            flex: 1;
            height: 56px;
            background: var(--primary-gradient);
            border: none;
            border-radius: var(--radius-full);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: var(--transition-smooth);
        }
        
        .scan-btn:active {
            transform: scale(0.98);
        }
        
        .scan-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .scan-result {
            position: absolute;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 20px;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid rgba(34, 197, 94, 0.3);
            z-index: 100;
            display: none;
        }
        
        .scan-result.show {
            transform: translateY(0);
            opacity: 1;
            display: block;
        }
        
        #scannerLoading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            text-align: center;
            z-index: 50;
            display: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== RECIPES PAGE ===== */
        .recipes-page {
            padding: 20px;
        }
        
        .recipe-filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 24px;
            padding-bottom: 8px;
        }
        
        .filter-chip {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .filter-chip.active {
            background: var(--primary-gradient);
        }
        
        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
        }
        
        .recipe-card {
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .recipe-card:active {
            transform: scale(0.98);
        }
        
        .recipe-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .recipe-time {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 8px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .recipe-title {
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .recipe-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* ===== MEAL PLANNER PAGE ===== */
        .meal-planner-page {
            padding: 20px;
        }
        
        /* Week Navigation */
        .week-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .week-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
            flex: 1;
        }
        
        .nav-btn {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
        
        /* Days Grid */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 24px;
        }
        
        .day-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            border-radius: var(--radius-md);
            padding: 8px;
        }
        
        .day-card:active {
            transform: scale(0.95);
        }
        
        .day-card.active {
            background: var(--primary-gradient);
        }
        
        .day-name {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 4px;
            opacity: 0.8;
        }
        
        .day-card.active .day-name {
            opacity: 1;
            color: white;
        }
        
        .day-number {
            font-size: 1.2rem;
            font-weight: 800;
        }
        
        .day-card.active .day-number {
            color: white;
        }
        
        /* Daily Meals */
        .daily-meals {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .meal-time {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .meal-time-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .meal-time-label {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .meal-slot {
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
        }
        
        .meal-slot:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .meal-slot.has-meal {
            border-style: solid;
            border-color: var(--primary);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .empty-slot-text {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
        }
        
        .meal-preview {
            width: 100%;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .meal-preview-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
        }
        
        .meal-preview-info {
            flex: 1;
        }
        
        .meal-preview-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .meal-preview-details {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            gap: 12px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }
        
        .btn {
            padding: 14px 24px;
            border-radius: var(--radius-full);
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ===== TRAINING PAGE ===== */
        .training-page {
            padding: 20px;
        }
        
        .training-header {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .ai-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
        }
        
        .ai-level {
            position: absolute;
            bottom: -10px;
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-weight: 700;
            border: 3px solid #0f172a;
        }
        
        .training-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .training-stat {
            padding: 20px;
            text-align: center;
        }
        
        .training-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .training-item {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .training-item:active {
            transform: scale(0.98);
        }
        
        .training-item-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 12px;
        }
        
        /* Meal Selection Modal */
        .meal-modal {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(30px);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            z-index: 1001;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .meal-modal.active {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }
        
        .modal-handle {
            width: 40px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            margin: 0 auto 16px;
        }
        
        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
        }
        
        .modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .modal-close:active {
            transform: scale(0.9);
        }
        
        .modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* Meal Categories */
        .meal-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .category-card {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition-smooth);
            border-radius: var(--radius-lg);
            padding: 12px;
        }
        
        .category-card:active {
            transform: scale(0.95);
        }
        
        .category-card.active {
            background: var(--primary-gradient);
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }
        
        .category-card.active .category-icon {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .category-name {
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }
        
        /* Meal List */
        .meal-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .meal-option {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: var(--transition-smooth);
            border-radius: var(--radius-lg);
        }
        
        .meal-option:active {
            transform: scale(0.995);
        }
        
        .meal-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .meal-option-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            color: white;
            flex-shrink: 0;
        }
        
        .meal-option-info {
            flex: 1;
        }
        
        .meal-option-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .meal-option-details {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 6px;
        }
        
        .meal-option-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .meal-tag {
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
        }
        
        .meal-option-price {
            font-weight: 700;
            color: #22c55e;
            font-size: 1.1rem;
            margin-left: auto;
        }
        
        /* Shopping List Panel */
        .shopping-list-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(30px);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            z-index: 1002;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .shopping-list-panel.active {
            transform: translateY(0);
        }
        
        .list-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .list-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: 0 auto 16px;
        }
        
        .list-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
        }
        
        .list-close {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .list-close:active {
            transform: scale(0.9);
        }
        
        .list-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .list-summary {
            background: rgba(34, 197, 94, 0.1);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(34, 197, 94, 0.2);
            text-align: center;
        }
        
        .total-cost {
            font-size: 2.5rem;
            font-weight: 900;
            color: #22c55e;
            margin-bottom: 8px;
            font-family: 'Poppins', sans-serif;
        }
        
        .total-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .list-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .list-item {
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .item-check {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            flex-shrink: 0;
        }
        
        .item-check.checked {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .item-check.checked i {
            opacity: 1;
        }
        
        .item-check i {
            font-size: 0.8rem;
            opacity: 0;
            transition: var(--transition-smooth);
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .item-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .item-quantity {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: var(--radius-full);
        }
        
        .item-price {
            font-weight: 700;
            color: #22c55e;
        }
        
        .list-actions {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Recipe Detail Modal */
        .recipe-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(30px);
            z-index: 1003;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            max-width: 500px;
            margin: 0 auto;
            overflow-y: auto;
        }
        
        .recipe-modal.active {
            transform: translateY(0);
        }
        
        .recipe-modal-header {
            padding: 20px;
            position: relative;
            text-align: center;
        }
        
        .recipe-modal-image {
            width: 200px;
            height: 200px;
            border-radius: var(--radius-xl);
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }
        
        .recipe-modal-close {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .recipe-modal-content {
            padding: 20px;
        }
        
        .recipe-section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #22c55e;
        }
        
        .ingredient-list, .step-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .ingredient-item, .step-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
        }
        
        /* Backdrop */
        .backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        
        .backdrop.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(34, 197, 94, 0.9);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 2000;
            border-left: 4px solid #16a34a;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Safe Areas */
        .safe-area-top {
            height: env(safe-area-inset-top, 20px);
            background: linear-gradient(to bottom, rgba(34, 197, 94, 0.8), transparent);
        }
        
        .safe-area-bottom {
            height: env(safe-area-inset-bottom, 0px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }
        
        /* Responsive */
        @media (max-width: 350px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .days-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .pantry-grid, .recipe-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Liquid Background -->
    <div class="liquid-background">
        <div class="liquid-blob blob-1"></div>
        <div class="liquid-blob blob-2"></div>
    </div>
    
    <!-- App Shell -->
    <div class="app-shell">
        <!-- Safe Area Top -->
        <div class="safe-area-top"></div>
        
        <!-- Header -->
        <header class="app-header glass-effect">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">DarsNest AI</div>
            </div>
            
            <div class="header-actions">
                <button class="header-btn" id="notificationBtn">
                    <i class="fas fa-bell"></i>
                    <span class="tab-badge" style="position: absolute; top: -5px; right: -5px;">3</span>
                </button>
                <button class="header-btn" id="scanBtn">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
        </header>
        
        <!-- Page Container -->
        <div class="page-container">
            <!-- Home Page -->
            <div class="page home-page active" id="homePage">
                <!-- Welcome Card -->
                <div class="welcome-card glass-effect">
                    <h1>Welcome, Chef! üë®‚Äçüç≥</h1>
                    <p>Your AI kitchen assistant is ready to help you cook smarter.</p>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="action-card glass-effect" data-action="scan">
                        <div class="action-icon" style="background: var(--primary-gradient);">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="action-title">Smart Scan</div>
                        <div class="action-subtitle">AI-powered food detection</div>
                    </div>
                    
                    <div class="action-card glass-effect" data-action="train">
                        <div class="action-icon" style="background: var(--secondary-gradient);">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="action-title">Train AI</div>
                        <div class="action-subtitle">Improve food recognition</div>
                    </div>
                    
                    <div class="action-card glass-effect" data-action="recipes">
                        <div class="action-icon" style="background: var(--warning-gradient);">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="action-title">AI Recipes</div>
                        <div class="action-subtitle">Personalized suggestions</div>
                    </div>
                    
                    <div class="action-card glass-effect" data-action="shopping">
                        <div class="action-icon" style="background: var(--danger-gradient);">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="action-title">Smart Shopping</div>
                        <div class="action-subtitle">Auto-generated list</div>
                    </div>
                </div>
                
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card glass-effect">
                        <div class="stat-icon" style="background: var(--primary-gradient);">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-value" id="totalItemsCount">42</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    
                    <div class="stat-card glass-effect">
                        <div class="stat-icon" style="background: var(--success-gradient);">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="stat-value">36</div>
                        <div class="stat-label">Fresh</div>
                    </div>
                    
                    <div class="stat-card glass-effect">
                        <div class="stat-icon" style="background: var(--warning-gradient);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value">5</div>
                        <div class="stat-label">Expiring</div>
                    </div>
                    
                    <div class="stat-card glass-effect">
                        <div class="stat-icon" style="background: var(--danger-gradient);">
                            <i class="fas fa-exclamation"></i>
                        </div>
                        <div class="stat-value">1</div>
                        <div class="stat-label">Expired</div>
                    </div>
                </div>
                
                <!-- Pantry Preview -->
                <div class="section-header">
                    <div class="section-title">Pantry Preview</div>
                    <a href="#" class="view-all-btn" data-page="pantry">View All</a>
                </div>
                
                <div class="pantry-items">
                    <div class="pantry-item glass-effect">
                        <div class="item-category">Produce</div>
                        <div class="item-name">Tomatoes</div>
                        <div class="item-details">5 pieces ¬∑ 2 days left</div>
                        <div class="expiry-bar">
                            <div class="expiry-fill" style="width: 70%; background: var(--warning-gradient);"></div>
                        </div>
                    </div>
                    
                    <div class="pantry-item glass-effect">
                        <div class="item-category">Dairy</div>
                        <div class="item-name">Eggs</div>
                        <div class="item-details">12 pieces ¬∑ 1 week left</div>
                        <div class="expiry-bar">
                            <div class="expiry-fill" style="width: 85%; background: var(--success-gradient);"></div>
                        </div>
                    </div>
                    
                    <div class="pantry-item glass-effect">
                        <div class="item-category">Dairy</div>
                        <div class="item-name">Milk</div>
                        <div class="item-details">1 gallon ¬∑ Tomorrow</div>
                        <div class="expiry-bar">
                            <div class="expiry-fill" style="width: 30%; background: var(--danger-gradient);"></div>
                        </div>
                    </div>
                    
                    <div class="pantry-item glass-effect">
                        <div class="item-category">Grains</div>
                        <div class="item-name">Rice</div>
                        <div class="item-details">5 lbs ¬∑ 6 months left</div>
                        <div class="expiry-bar">
                            <div class="expiry-fill" style="width: 100%; background: var(--success-gradient);"></div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Progress -->
                <div class="ai-progress glass-effect">
                    <div class="progress-value">78%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 78%"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; opacity: 0.8;">
                        <span>AI Training Progress</span>
                        <span>39,000/50,000 photos</span>
                    </div>
                </div>
            </div>
            
            <!-- Pantry Page -->
            <div class="page pantry-page" id="pantryPage">
                <div class="pantry-header">
                    <h1 class="page-title">Pantry Management</h1>
                </div>
                
                <div class="search-bar glass-effect">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" placeholder="Search items...">
                </div>
                
                <div class="pantry-categories">
                    <div class="category-tab active">All Items</div>
                    <div class="category-tab">Fresh</div>
                    <div class="category-tab">Expiring</div>
                    <div class="category-tab">Dairy</div>
                    <div class="category-tab">Produce</div>
                    <div class="category-tab">Grains</div>
                </div>
                
                <div class="pantry-grid" id="pantryGrid">
                    <!-- Items loaded dynamically -->
                </div>
            </div>
            
            <!-- Scanner Page -->
            <div class="page scanner-page" id="scannerPage">
                <div class="scanner-viewport">
                    <video id="scannerVideo" autoplay playsinline></video>
                    <div class="scanner-frame">
                        <div class="scanner-corner corner-tl"></div>
                        <div class="scanner-corner corner-tr"></div>
                        <div class="scanner-corner corner-bl"></div>
                        <div class="scanner-corner corner-br"></div>
                        <div class="scanner-line"></div>
                    </div>
                    
                    <div class="scan-result glass-effect" id="scanResult">
                        <!-- Results appear here -->
                    </div>
                    
                    <!-- Loading indicator -->
                    <div id="scannerLoading" class="glass-effect">
                        <div class="loading-spinner"></div>
                        <div>Loading AI Model...</div>
                        <div style="font-size: 0.9rem; opacity: 0.7; margin-top: 8px;">This may take a few seconds</div>
                    </div>
                </div>
                
                <div class="scanner-controls">
                    <button class="scan-btn" id="startScanBtn">
                        <i class="fas fa-camera"></i>
                        Start Scanning
                    </button>
                    <button class="scan-btn secondary" id="stopScanBtn" style="display: none;">
                        <i class="fas fa-stop"></i>
                        Stop Scanning
                    </button>
                </div>
            </div>
            
            <!-- Recipes Page -->
            <div class="page recipes-page" id="recipesPage">
                <div class="page-title">AI Recipes</div>
                <div class="page-subtitle">Personalized suggestions based on your pantry</div>
                
                <div class="recipe-filters">
                    <div class="filter-chip active">All Recipes</div>
                    <div class="filter-chip">Breakfast</div>
                    <div class="filter-chip">Lunch</div>
                    <div class="filter-chip">Dinner</div>
                    <div class="filter-chip">Quick</div>
                    <div class="filter-chip">Healthy</div>
                </div>
                
                <div class="recipe-grid" id="recipeGrid">
                    <!-- Recipes loaded dynamically -->
                </div>
            </div>
            
            <!-- Meal Planner Page -->
            <div class="page meal-planner-page" id="mealPlannerPage">
                <!-- Week Navigation -->
                <div class="week-nav">
                    <button class="nav-btn" id="prevWeekBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="week-title">This Week</div>
                    <button class="nav-btn" id="nextWeekBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Days Grid -->
                <div class="days-grid" id="daysGrid">
                    <!-- Days loaded dynamically -->
                </div>
                
                <!-- Daily Meals -->
                <div class="daily-meals">
                    <!-- Breakfast -->
                    <div class="meal-time">
                        <div class="meal-time-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div class="meal-time-label">Breakfast (8:00 AM)</div>
                    </div>
                    <div class="meal-slot glass-effect" data-meal-type="breakfast" id="breakfastSlot">
                        <div class="empty-slot-text">Select Breakfast</div>
                    </div>
                    
                    <!-- Lunch -->
                    <div class="meal-time">
                        <div class="meal-time-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div class="meal-time-label">Lunch (12:30 PM)</div>
                    </div>
                    <div class="meal-slot glass-effect" data-meal-type="lunch" id="lunchSlot">
                        <div class="empty-slot-text">Select Lunch</div>
                    </div>
                    
                    <!-- Dinner -->
                    <div class="meal-time">
                        <div class="meal-time-icon">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="meal-time-label">Dinner (6:00 PM)</div>
                    </div>
                    <div class="meal-slot glass-effect" data-meal-type="dinner" id="dinnerSlot">
                        <div class="empty-slot-text">Select Dinner</div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="clearDayBtn">
                        <i class="fas fa-trash"></i>
                        Clear Day
                    </button>
                    <button class="btn btn-primary" id="generateListBtn">
                        <i class="fas fa-shopping-cart"></i>
                        Shopping List
                    </button>
                </div>
            </div>
            
            <!-- Training Page -->
            <div class="page training-page" id="trainingPage">
                <div class="training-header">
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                        <div class="ai-level">Level 7</div>
                    </div>
                    <h1 class="page-title">Train Chef Maya</h1>
                    <div class="page-subtitle">Help improve AI food recognition</div>
                </div>
                
                <div class="training-stats">
                    <div class="training-stat glass-effect">
                        <div class="stat-value">78%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    
                    <div class="training-stat glass-effect">
                        <div class="stat-value">39,420</div>
                        <div class="stat-label">Images Trained</div>
                    </div>
                </div>
                
                <div class="section-header">
                    <div class="section-title">Training Exercises</div>
                </div>
                
                <div class="training-items">
                    <div class="training-item glass-effect" data-training="identify">
                        <div class="training-item-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="training-title">Identify Items</div>
                        <div class="training-subtitle">Label food images</div>
                    </div>
                    
                    <div class="training-item glass-effect" data-training="verify">
                        <div class="training-item-icon">
                            <i class="fas fa-check-double"></i>
                        </div>
                        <div class="training-title">Verify Scans</div>
                        <div class="training-subtitle">Review AI detections</div>
                    </div>
                    
                    <div class="training-item glass-effect" data-training="categorize">
                        <div class="training-item-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="training-title">Categorize</div>
                        <div class="training-subtitle">Group similar foods</div>
                    </div>
                    
                    <div class="training-item glass-effect" data-training="expiry">
                        <div class="training-item-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="training-title">Expiry Detection</div>
                        <div class="training-subtitle">Train freshness recognition</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Bar -->
        <nav class="tab-bar glass-effect">
            <a href="#" class="tab-item active" data-page="home">
                <div class="tab-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Home</div>
            </a>
            
            <a href="#" class="tab-item" data-page="pantry">
                <div class="tab-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Pantry</div>
            </a>
            
            <a href="#" class="tab-item" data-page="scanner">
                <div class="tab-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Scan</div>
            </a>
            
            <a href="#" class="tab-item" data-page="recipes">
                <div class="tab-icon">
                    <i class="fas fa-utensils"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Recipes</div>
            </a>
            
            <a href="#" class="tab-item" data-page="meal-planner">
                <div class="tab-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Meal Plan</div>
                <div class="tab-badge" id="mealPlanBadge">0</div>
            </a>
            
            <a href="#" class="tab-item" data-page="training">
                <div class="tab-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div style="font-size: 11px; font-weight: 600;">Train AI</div>
            </a>
        </nav>
        
        <!-- Safe Area Bottom -->
        <div class="safe-area-bottom"></div>
    </div>
    
    <!-- Meal Selection Modal -->
    <div class="backdrop" id="backdrop"></div>
    
    <div class="meal-modal" id="mealModal">
        <div class="modal-header">
            <div class="modal-handle"></div>
            <div class="modal-title" id="modalTitle">Select a Meal</div>
            <button class="modal-close" id="closeModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-content">
            <!-- Categories -->
            <div class="meal-categories" id="mealCategories">
                <div class="category-card glass-effect active" data-category="all">
                    <div class="category-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="category-name">All Meals</div>
                </div>
                
                <div class="category-card glass-effect" data-category="breakfast">
                    <div class="category-icon">
                        <i class="fas fa-egg"></i>
                    </div>
                    <div class="category-name">Breakfast</div>
                </div>
                
                <div class="category-card glass-effect" data-category="lunch">
                    <div class="category-icon">
                        <i class="fas fa-hamburger"></i>
                    </div>
                    <div class="category-name">Lunch</div>
                </div>
                
                <div class="category-card glass-effect" data-category="dinner">
                    <div class="category-icon">
                        <i class="fas fa-drumstick-bite"></i>
                    </div>
                    <div class="category-name">Dinner</div>
                </div>
                
                <div class="category-card glass-effect" data-category="vegetarian">
                    <div class="category-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="category-name">Vegetarian</div>
                </div>
                
                <div class="category-card glass-effect" data-category="quick">
                    <div class="category-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="category-name">Quick</div>
                </div>
            </div>
            
            <!-- Meal List -->
            <div class="meal-list" id="mealList">
                <!-- Meals loaded dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Shopping List Panel -->
    <div class="shopping-list-panel" id="shoppingListPanel">
        <div class="list-header">
            <div class="list-handle"></div>
            <div class="list-title">Shopping List</div>
            <button class="list-close" id="closeListBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="list-content">
            <div class="list-summary">
                <div class="total-cost" id="totalCost">$0.00</div>
                <div class="total-label">Estimated Total Cost</div>
            </div>
            
            <div class="list-items" id="shoppingListItems">
                <!-- Items loaded dynamically -->
            </div>
        </div>
        
        <div class="list-actions">
            <button class="btn btn-secondary" id="clearListBtn">
                <i class="fas fa-trash"></i>
                Clear
            </button>
            <button class="btn btn-primary" id="saveListBtn">
                <i class="fas fa-save"></i>
                Save List
            </button>
        </div>
    </div>

    <!-- Complete JavaScript with TensorFlow.js Integration -->
    <script>
        // ===== MEAL DATABASE =====
        const mealDatabase = {
            categories: [
                { id: 'all', name: 'All Meals', icon: 'fa-star' },
                { id: 'breakfast', name: 'Breakfast', icon: 'fa-egg' },
                { id: 'lunch', name: 'Lunch', icon: 'fa-hamburger' },
                { id: 'dinner', name: 'Dinner', icon: 'fa-drumstick-bite' },
                { id: 'vegetarian', name: 'Vegetarian', icon: 'fa-leaf' },
                { id: 'quick', name: 'Quick Meals', icon: 'fa-bolt' }
            ],
            
            meals: [
                {
                    id: 1,
                    name: "Avocado Toast",
                    category: "breakfast",
                    type: "breakfast",
                    tags: ["vegetarian", "quick", "healthy"],
                    time: 10,
                    difficulty: "Easy",
                    calories: 320,
                    price: 3.50,
                    icon: "ü•ë",
                    image: "ü•ë",
                    ingredients: [
                        { name: "Bread", quantity: "2 slices", price: 0.80, unit: "loaf" },
                        { name: "Avocado", quantity: "1", price: 1.50, unit: "each" },
                        { name: "Eggs", quantity: "2", price: 0.40, unit: "dozen" },
                        { name: "Lemon Juice", quantity: "1 tbsp", price: 0.10, unit: "bottle" },
                        { name: "Salt & Pepper", quantity: "to taste", price: 0.10, unit: "shakers" }
                    ],
                    prep: [
                        "Toast the bread until golden brown",
                        "Cut avocado in half, remove pit, and scoop out flesh",
                        "Mash avocado with lemon juice, salt, and pepper",
                        "Spread avocado mixture on toast",
                        "Fry eggs sunny-side up and place on top",
                        "Season with additional salt and pepper to taste"
                    ]
                },
                {
                    id: 2,
                    name: "Greek Yogurt Bowl",
                    category: "breakfast",
                    type: "breakfast",
                    tags: ["vegetarian", "protein", "quick"],
                    time: 5,
                    difficulty: "Easy",
                    calories: 280,
                    price: 4.75,
                    icon: "ü•£",
                    image: "ü•£",
                    ingredients: [
                        { name: "Greek Yogurt", quantity: "1 cup", price: 1.50, unit: "32oz tub" },
                        { name: "Mixed Berries", quantity: "¬Ω cup", price: 2.00, unit: "pack" },
                        { name: "Honey", quantity: "1 tbsp", price: 0.50, unit: "jar" },
                        { name: "Granola", quantity: "¬º cup", price: 0.75, unit: "bag" }
                    ],
                    prep: [
                        "Scoop Greek yogurt into a bowl",
                        "Wash and add mixed berries",
                        "Drizzle with honey",
                        "Top with granola",
                        "Serve immediately"
                    ]
                },
                {
                    id: 3,
                    name: "Chicken Salad",
                    category: "lunch",
                    type: "lunch",
                    tags: ["protein", "healthy", "quick"],
                    time: 15,
                    difficulty: "Easy",
                    calories: 420,
                    price: 8.75,
                    icon: "ü•ó",
                    image: "ü•ó",
                    ingredients: [
                        { name: "Chicken Breast", quantity: "¬Ω lb", price: 2.00, unit: "lb" },
                        { name: "Mixed Greens", quantity: "2 cups", price: 1.25, unit: "bag" },
                        { name: "Cherry Tomatoes", quantity: "¬Ω cup", price: 0.50, unit: "pack" },
                        { name: "Cucumber", quantity: "¬Ω", price: 0.40, unit: "each" },
                        { name: "Olive Oil", quantity: "2 tbsp", price: 0.20, unit: "bottle" }
                    ],
                    prep: [
                        "Grill chicken breast until cooked through",
                        "Let chicken rest, then slice into strips",
                        "Chop cucumber and halve cherry tomatoes",
                        "Arrange mixed greens in a bowl",
                        "Top with chicken, tomatoes, and cucumber",
                        "Drizzle with olive oil and serve"
                    ]
                },
                {
                    id: 4,
                    name: "Turkey Sandwich",
                    category: "lunch",
                    type: "lunch",
                    tags: ["quick", "protein", "easy"],
                    time: 10,
                    difficulty: "Easy",
                    calories: 380,
                    price: 6.25,
                    icon: "ü•™",
                    image: "ü•™",
                    ingredients: [
                        { name: "Bread", quantity: "2 slices", price: 0.80, unit: "loaf" },
                        { name: "Turkey", quantity: "4 slices", price: 1.60, unit: "pack" },
                        { name: "Cheese", quantity: "2 slices", price: 1.00, unit: "pack" },
                        { name: "Lettuce", quantity: "2 leaves", price: 0.25, unit: "head" },
                        { name: "Mayonnaise", quantity: "1 tbsp", price: 0.20, unit: "jar" }
                    ],
                    prep: [
                        "Spread mayonnaise on both slices of bread",
                        "Layer turkey slices on one piece",
                        "Add cheese on top of turkey",
                        "Place lettuce leaves on cheese",
                        "Top with second slice of bread",
                        "Cut diagonally and serve"
                    ]
                },
                {
                    id: 5,
                    name: "Spaghetti Bolognese",
                    category: "dinner",
                    type: "dinner",
                    tags: ["family", "classic", "hearty"],
                    time: 45,
                    difficulty: "Medium",
                    calories: 650,
                    price: 12.50,
                    icon: "üçù",
                    image: "üçù",
                    ingredients: [
                        { name: "Spaghetti", quantity: "¬Ω lb", price: 1.20, unit: "box" },
                        { name: "Ground Beef", quantity: "1 lb", price: 6.00, unit: "lb" },
                        { name: "Tomato Sauce", quantity: "24 oz", price: 2.00, unit: "jar" },
                        { name: "Onion", quantity: "1", price: 0.30, unit: "each" },
                        { name: "Garlic", quantity: "3 cloves", price: 0.20, unit: "head" }
                    ],
                    prep: [
                        "Cook spaghetti according to package directions",
                        "Dice onion and mince garlic",
                        "Brown ground beef in a large pan",
                        "Add onions and garlic, cook until soft",
                        "Pour in tomato sauce, simmer for 30 minutes",
                        "Serve sauce over cooked spaghetti"
                    ]
                },
                {
                    id: 6,
                    name: "Grilled Salmon",
                    category: "dinner",
                    type: "dinner",
                    tags: ["healthy", "protein", "quick"],
                    time: 20,
                    difficulty: "Easy",
                    calories: 480,
                    price: 14.20,
                    icon: "üêü",
                    image: "üêü",
                    ingredients: [
                        { name: "Salmon", quantity: "1 lb", price: 10.00, unit: "lb" },
                        { name: "Asparagus", quantity: "1 bunch", price: 2.50, unit: "bunch" },
                        { name: "Lemon", quantity: "1", price: 0.50, unit: "each" },
                        { name: "Olive Oil", quantity: "2 tbsp", price: 0.20, unit: "bottle" },
                        { name: "Salt & Pepper", quantity: "to taste", price: 0.10, unit: "shakers" }
                    ],
                    prep: [
                        "Season salmon with salt, pepper, and olive oil",
                        "Preheat grill to medium-high heat",
                        "Grill salmon for 6 minutes per side",
                        "Toss asparagus with olive oil, salt, and pepper",
                        "Grill asparagus alongside salmon",
                        "Serve with lemon wedges"
                    ]
                }
            ]
        };
        
        // ===== RECIPE DATABASE =====
        const recipeDatabase = [
            {
                id: "avocado-toast",
                name: "Avocado Toast",
                image: "ü•ë",
                time: 10,
                calories: 320,
                difficulty: "Easy",
                rating: 4.8,
                category: "breakfast",
                tags: ["vegetarian", "quick", "healthy"],
                ingredients: [
                    "2 slices of bread",
                    "1 ripe avocado",
                    "2 eggs",
                    "1 tbsp lemon juice",
                    "Salt and pepper to taste",
                    "Red pepper flakes (optional)"
                ],
                steps: [
                    "Toast the bread until golden and crisp",
                    "While bread toasts, cut avocado in half and remove pit",
                    "Scoop avocado flesh into a bowl and mash with lemon juice",
                    "Season avocado mixture with salt and pepper",
                    "Heat a non-stick pan and fry eggs sunny-side up",
                    "Spread mashed avocado evenly on toast",
                    "Top each toast with a fried egg",
                    "Season with additional salt, pepper, and red pepper flakes if desired"
                ]
            },
            {
                id: "chicken-salad",
                name: "Chicken Salad",
                image: "ü•ó",
                time: 15,
                calories: 420,
                difficulty: "Easy",
                rating: 4.6,
                category: "lunch",
                tags: ["protein", "healthy"],
                ingredients: [
                    "1 chicken breast (cooked)",
                    "4 cups mixed greens",
                    "¬Ω cup cherry tomatoes",
                    "¬Ω cucumber",
                    "2 tbsp olive oil",
                    "1 tbsp balsamic vinegar",
                    "Salt and pepper to taste"
                ],
                steps: [
                    "Slice cooked chicken breast into thin strips",
                    "Wash and dry mixed greens",
                    "Halve cherry tomatoes",
                    "Slice cucumber into half-moons",
                    "Combine greens, tomatoes, and cucumber in a large bowl",
                    "Arrange chicken strips on top",
                    "Drizzle with olive oil and balsamic vinegar",
                    "Season with salt and pepper, toss gently before serving"
                ]
            },
            {
                id: "spaghetti",
                name: "Spaghetti Bolognese",
                image: "üçù",
                time: 45,
                calories: 650,
                difficulty: "Medium",
                rating: 4.9,
                category: "dinner",
                tags: ["family", "classic"],
                ingredients: [
                    "¬Ω lb spaghetti",
                    "1 lb ground beef",
                    "1 jar (24oz) tomato sauce",
                    "1 onion, diced",
                    "3 cloves garlic, minced",
                    "2 tbsp olive oil",
                    "Salt and pepper to taste",
                    "Parmesan cheese for serving"
                ],
                steps: [
                    "Bring a large pot of salted water to boil",
                    "Cook spaghetti according to package directions",
                    "Heat olive oil in a large pan over medium heat",
                    "Add diced onion and cook until translucent",
                    "Add minced garlic and cook for 1 minute",
                    "Add ground beef and cook until browned",
                    "Pour in tomato sauce and simmer for 30 minutes",
                    "Season with salt and pepper",
                    "Drain spaghetti and toss with sauce",
                    "Serve with grated Parmesan cheese"
                ]
            }
        ];
        
        // ===== APP STATE =====
        const appState = {
            currentPage: 'home',
            currentWeek: 0,
            selectedDay: new Date().getDay(),
            mealPlan: {},
            selectedCategory: 'all',
            selectedMealType: null,
            shoppingList: [],
            selectedItems: new Set(),
            totalCost: 0,
            pantryItems: [],
            scanner: {
                isScanning: false,
                model: null,
                stream: null,
                videoElement: null,
                canvasElement: null
            }
        };
        
        // ===== TENSORFLOW SCANNER =====
        class FoodScanner {
            constructor() {
                this.model = null;
                this.isLoading = false;
                this.videoElement = null;
                this.canvasElement = null;
                this.stream = null;
                this.isScanning = false;
                this.detectionCanvas = null;
                this.foodDatabase = this.getFoodDatabase();
            }
            
            getFoodDatabase() {
                return {
                    'apple': { name: 'Apple', category: 'fruit', emoji: 'üçé', expiryDays: 14, quantity: '1 piece' },
                    'banana': { name: 'Banana', category: 'fruit', emoji: 'üçå', expiryDays: 7, quantity: '1 bunch' },
                    'orange': { name: 'Orange', category: 'fruit', emoji: 'üçä', expiryDays: 21, quantity: '1 piece' },
                    'carrot': { name: 'Carrot', category: 'vegetable', emoji: 'ü•ï', expiryDays: 30, quantity: '1 piece' },
                    'broccoli': { name: 'Broccoli', category: 'vegetable', emoji: 'ü•¶', expiryDays: 10, quantity: '1 head' },
                    'milk bottle': { name: 'Milk', category: 'dairy', emoji: 'ü•õ', expiryDays: 7, quantity: '1 gallon' },
                    'wine glass': { name: 'Wine', category: 'beverage', emoji: 'üç∑', expiryDays: 365, quantity: '1 bottle' },
                    'bottle': { name: 'Water Bottle', category: 'beverage', emoji: 'üíß', expiryDays: 730, quantity: '1 bottle' },
                    'sandwich': { name: 'Sandwich', category: 'prepared', emoji: 'ü•™', expiryDays: 3, quantity: '1 piece' },
                    'pizza': { name: 'Pizza', category: 'prepared', emoji: 'üçï', expiryDays: 5, quantity: '1 slice' },
                    'donut': { name: 'Donut', category: 'bakery', emoji: 'üç©', expiryDays: 5, quantity: '1 piece' },
                    'cake': { name: 'Cake', category: 'bakery', emoji: 'üç∞', expiryDays: 7, quantity: '1 slice' },
                    'egg': { name: 'Egg', category: 'dairy', emoji: 'ü•ö', expiryDays: 28, quantity: '1 piece' },
                    'bread': { name: 'Bread', category: 'bakery', emoji: 'üçû', expiryDays: 7, quantity: '1 loaf' },
                    'tomato': { name: 'Tomato', category: 'vegetable', emoji: 'üçÖ', expiryDays: 10, quantity: '1 piece' },
                    'avocado': { name: 'Avocado', category: 'fruit', emoji: 'ü•ë', expiryDays: 5, quantity: '1 piece' }
                };
            }
            
            async init() {
                try {
                    this.isLoading = true;
                    this.showLoading(true);
                    
                    console.log('üöÄ Loading TensorFlow.js model...');
                    this.model = await cocoSsd.load();
                    
                    console.log('‚úÖ TensorFlow model loaded successfully!');
                    this.isLoading = false;
                    this.showLoading(false);
                    
                    this.showNotification('AI Model loaded! Ready to scan üéØ', 'success');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error loading TensorFlow model:', error);
                    this.isLoading = false;
                    this.showLoading(false);
                    this.showNotification('Failed to load AI model. Please refresh.', 'error');
                    return false;
                }
            }
            
            async startCamera() {
                try {
                    this.videoElement = document.getElementById('scannerVideo');
                    
                    if (!this.videoElement) {
                        console.error('Video element not found');
                        return false;
                    }
                    
                    // Get camera access
                    this.stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false
                    });
                    
                    this.videoElement.srcObject = this.stream;
                    await this.videoElement.play();
                    
                    // Create canvas for detection overlay
                    this.createDetectionCanvas();
                    
                    console.log('üì∑ Camera started successfully');
                    return true;
                } catch (error) {
                    console.error('‚ùå Camera error:', error);
                    this.showNotification('Camera access denied. Please enable camera permissions.', 'error');
                    return false;
                }
            }
            
            createDetectionCanvas() {
                if (this.detectionCanvas) {
                    this.detectionCanvas.remove();
                }
                
                this.detectionCanvas = document.createElement('canvas');
                this.detectionCanvas.style.position = 'absolute';
                this.detectionCanvas.style.top = '0';
                this.detectionCanvas.style.left = '0';
                this.detectionCanvas.style.width = '100%';
                this.detectionCanvas.style.height = '100%';
                this.detectionCanvas.style.zIndex = '20';
                this.detectionCanvas.style.pointerEvents = 'none';
                
                const container = this.videoElement.parentElement;
                container.appendChild(this.detectionCanvas);
            }
            
            async startScanning() {
                if (!this.model) {
                    const loaded = await this.init();
                    if (!loaded) return;
                }
                
                if (!this.stream) {
                    const cameraStarted = await this.startCamera();
                    if (!cameraStarted) return;
                }
                
                this.isScanning = true;
                document.getElementById('startScanBtn').style.display = 'none';
                document.getElementById('stopScanBtn').style.display = 'flex';
                
                this.scanLoop();
            }
            
            stopScanning() {
                this.isScanning = false;
                
                // Clear canvas
                if (this.detectionCanvas) {
                    const ctx = this.detectionCanvas.getContext('2d');
                    ctx.clearRect(0, 0, this.detectionCanvas.width, this.detectionCanvas.height);
                }
                
                // Update UI
                document.getElementById('startScanBtn').style.display = 'flex';
                document.getElementById('stopScanBtn').style.display = 'none';
                
                // Stop camera stream if needed
                if (this.stream && !this.isScanning) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                    if (this.videoElement) {
                        this.videoElement.srcObject = null;
                    }
                }
            }
            
            async scanLoop() {
                if (!this.isScanning || !this.model || !this.videoElement) return;
                
                try {
                    // Get predictions
                    const predictions = await this.model.detect(this.videoElement);
                    
                    // Filter for food items
                    const foodPredictions = this.filterFoodItems(predictions);
                    
                    // Draw detections
                    this.drawDetections(foodPredictions);
                    
                    // Check for high confidence detection
                    if (foodPredictions.length > 0) {
                        const bestPrediction = foodPredictions[0];
                        if (bestPrediction.score > 0.7) {
                            this.handleFoodDetection(bestPrediction);
                            return; // Stop after detection
                        }
                    }
                    
                    // Continue scanning
                    if (this.isScanning) {
                        requestAnimationFrame(() => this.scanLoop());
                    }
                } catch (error) {
                    console.error('Scan error:', error);
                    if (this.isScanning) {
                        setTimeout(() => this.scanLoop(), 100);
                    }
                }
            }
            
            filterFoodItems(predictions) {
                const foodClasses = Object.keys(this.foodDatabase);
                
                return predictions
                    .filter(pred => {
                        const className = pred.class.toLowerCase();
                        return foodClasses.some(food => className.includes(food) || food.includes(className));
                    })
                    .map(pred => {
                        const className = pred.class.toLowerCase();
                        const foodMatch = Object.keys(this.foodDatabase).find(food => 
                            className.includes(food) || food.includes(className)
                        );
                        
                        return {
                            ...pred,
                            foodInfo: foodMatch ? this.foodDatabase[foodMatch] : null,
                            displayName: foodMatch ? this.foodDatabase[foodMatch].name : pred.class,
                            emoji: foodMatch ? this.foodDatabase[foodMatch].emoji : 'üçΩÔ∏è',
                            quantity: foodMatch ? this.foodDatabase[foodMatch].quantity : '1 piece'
                        };
                    })
                    .sort((a, b) => b.score - a.score);
            }
            
            drawDetections(predictions) {
                if (!this.detectionCanvas || !this.videoElement) return;
                
                const ctx = this.detectionCanvas.getContext('2d');
                const videoWidth = this.videoElement.videoWidth;
                const videoHeight = this.videoElement.videoHeight;
                
                // Match canvas to video dimensions
                this.detectionCanvas.width = videoWidth;
                this.detectionCanvas.height = videoHeight;
                
                // Clear previous drawings
                ctx.clearRect(0, 0, videoWidth, videoHeight);
                
                // Draw each detection
                predictions.forEach(prediction => {
                    const [x, y, width, height] = prediction.bbox;
                    
                    // Draw box
                    ctx.strokeStyle = '#22c55e';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x, y, width, height);
                    
                    // Draw label background
                    ctx.fillStyle = 'rgba(34, 197, 94, 0.8)';
                    const text = `${prediction.displayName} ${(prediction.score * 100).toFixed(0)}%`;
                    const textWidth = ctx.measureText(text).width;
                    
                    ctx.fillRect(x, y - 25, textWidth + 20, 25);
                    
                    // Draw label text
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 14px Inter, sans-serif';
                    ctx.fillText(text, x + 10, y - 8);
                    
                    // Draw emoji
                    if (prediction.emoji) {
                        ctx.font = '20px Arial';
                        ctx.fillText(prediction.emoji, x + width - 25, y + 25);
                    }
                });
            }
            
            handleFoodDetection(prediction) {
                this.stopScanning();
                
                const foodInfo = prediction.foodInfo || {
                    name: prediction.displayName,
                    category: 'unknown',
                    emoji: 'üçΩÔ∏è',
                    expiryDays: 7,
                    quantity: '1 piece'
                };
                
                // Calculate expiry date
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + foodInfo.expiryDays);
                
                // Create result object
                const result = {
                    name: foodInfo.name,
                    category: foodInfo.category,
                    emoji: foodInfo.emoji,
                    confidence: (prediction.score * 100).toFixed(1),
                    expiryDate: expiryDate.toISOString().split('T')[0],
                    expiryDays: foodInfo.expiryDays,
                    quantity: foodInfo.quantity,
                    timestamp: new Date().toISOString(),
                    barcode: null // Could be added with barcode scanner
                };
                
                console.log('üéØ Food detected:', result);
                this.showScanResult(result);
            }
            
            showScanResult(result) {
                const scanResult = document.getElementById('scanResult');
                if (!scanResult) return;
                
                scanResult.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="width: 60px; height: 60px; border-radius: var(--radius-md); background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                            ${result.emoji}
                        </div>
                        <div>
                            <div style="font-weight: 700; font-size: 1.3rem;">${result.name}</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">
                                ${result.category.charAt(0).toUpperCase() + result.category.slice(1)} ‚Ä¢ 
                                ${result.confidence}% confidence
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); border-radius: var(--radius-md); padding: 16px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <div>
                                <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 4px;">Quantity</div>
                                <div style="font-weight: 600;">${result.quantity}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 4px;">Expires in</div>
                                <div style="font-weight: 600; color: #22c55e;">${result.expiryDays} days</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 4px;">Category</div>
                                <div style="font-weight: 600;">${result.category}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 4px;">Confidence</div>
                                <div style="font-weight: 600;">${result.confidence}%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-primary" style="flex: ;" id="addScannedItem">
                            <i class="fas fa-plus"></i> Add to Pantry
                        </button>
                        <button class="btn btn-secondary" style="flex: 1;" id="scanAgainBtn">
                            <i class="fas fa-redo"></i> Scan Again
                        </button>
                    </div>
                `;
                
                scanResult.classList.add('show');
                
                // Add event listeners
                document.getElementById('addScannedItem').addEventListener('click', () => this.addToPantry(result));
                document.getElementById('scanAgainBtn').addEventListener('click', () => {
                    scanResult.classList.remove('show');
                    setTimeout(() => this.startScanning(), 500);
                });
            }
            
            addToPantry(item) {
                // Add to app state
                appState.pantryItems.push({
                    name: item.name,
                    quantity: this.parseQuantity(item.quantity),
                    category: item.category,
                    emoji: item.emoji,
                    addedDate: new Date().toISOString(),
                    expiryDate: item.expiryDate,
                    status: 'fresh'
                });
                
                // Update UI
                this.updatePantryStats();
                this.showNotification(`${item.name} added to pantry! ‚úÖ`, 'success');
                
                // Close scan result
                document.getElementById('scanResult').classList.remove('show');
                
                // Navigate to pantry page
                app.navigateTo('pantry');
            }
            
            parseQuantity(quantityStr) {
                const match = quantityStr.match(/(\d+)/);
                return match ? parseInt(match[1]) : 1;
            }
            
            updatePantryStats() {
                const totalItems = appState.pantryItems.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('totalItemsCount').textContent = totalItems;
            }
            
            showLoading(show) {
                const loadingElement = document.getElementById('scannerLoading');
                if (loadingElement) {
                    loadingElement.style.display = show ? 'block' : 'none';
                }
            }
            
            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'rgba(34, 197, 94, 0.9)' : 
                               type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 
                               'rgba(59, 130, 246, 0.9)'};
                    backdrop-filter: blur(20px);
                    border-radius: var(--radius-lg);
                    padding: 16px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    transform: translateY(-100px);
                    opacity: 0;
                    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                    z-index: 2000;
                    border-left: 4px solid ${type === 'success' ? '#16a34a' : 
                                      type === 'error' ? '#dc2626' : 
                                      '#2563eb'};
                `;
                
                notification.innerHTML = `
                    <div style="width: 36px; height: 36px; border-radius: var(--radius-md); background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; color: white; font-size: 1rem;">
                        <i class="fas fa-${type === 'success' ? 'check' : 
                                          type === 'error' ? 'exclamation-triangle' : 
                                          'info'}"></i>
                    </div>
                    <div style="flex: 1; font-weight: 600;">${message}</div>
                `;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateY(0)';
                    notification.style.opacity = '1';
                }, 10);
                
                // Auto-remove
                setTimeout(() => {
                    notification.style.transform = 'translateY(-100px)';
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
                
                this.hapticFeedback();
            }
            
            hapticFeedback() {
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }
        }
        
        // ===== DARSNEST APP =====
        class DarsNestApp {
            constructor() {
                this.scanner = new FoodScanner();
                this.init();
            }
            
            init() {
                this.setupViewport();
                this.cacheElements();
                this.bindEvents();
                this.setupDays();
                this.loadMealPlan();
                this.loadPantryItems();
                this.loadRecipes();
                this.updateBadge();
                this.setupMockData();
                
                console.log('üöÄ DarsNest AI Kitchen OS Initialized');
            }
            
            setupViewport() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                
                window.addEventListener('resize', () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                }, { passive: true });
            }
            
            cacheElements() {
                this.elements = {
                    pages: {
                        home: document.getElementById('homePage'),
                        pantry: document.getElementById('pantryPage'),
                        scanner: document.getElementById('scannerPage'),
                        recipes: document.getElementById('recipesPage'),
                        'meal-planner': document.getElementById('mealPlannerPage'),
                        training: document.getElementById('trainingPage')
                    },
                    tabs: document.querySelectorAll('.tab-item'),
                    actionCards: document.querySelectorAll('.action-card'),
                    daysGrid: document.getElementById('daysGrid'),
                    mealSlots: {
                        breakfast: document.getElementById('breakfastSlot'),
                        lunch: document.getElementById('lunchSlot'),
                        dinner: document.getElementById('dinnerSlot')
                    },
                    backdrop: document.getElementById('backdrop'),
                    mealModal: document.getElementById('mealModal'),
                    modalTitle: document.getElementById('modalTitle'),
                    mealCategories: document.getElementById('mealCategories'),
                    mealList: document.getElementById('mealList'),
                    closeModalBtn: document.getElementById('closeModalBtn'),
                    shoppingListPanel: document.getElementById('shoppingListPanel'),
                    totalCost: document.getElementById('totalCost'),
                    shoppingListItems: document.getElementById('shoppingListItems'),
                    closeListBtn: document.getElementById('closeListBtn'),
                    clearListBtn: document.getElementById('clearListBtn'),
                    saveListBtn: document.getElementById('saveListBtn'),
                    generateListBtn: document.getElementById('generateListBtn'),
                    clearDayBtn: document.getElementById('clearDayBtn'),
                    prevWeekBtn: document.getElementById('prevWeekBtn'),
                    nextWeekBtn: document.getElementById('nextWeekBtn'),
                    mealPlanBadge: document.getElementById('mealPlanBadge'),
                    notificationBtn: document.getElementById('notificationBtn'),
                    scanBtn: document.getElementById('scanBtn'),
                    startScanBtn: document.getElementById('startScanBtn'),
                    stopScanBtn: document.getElementById('stopScanBtn'),
                    pantryGrid: document.getElementById('pantryGrid'),
                    recipeGrid: document.getElementById('recipeGrid')
                };
            }
            
            bindEvents() {
                // Tab navigation
                this.elements.tabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = tab.dataset.page;
                        this.navigateTo(page);
                        this.hapticFeedback();
                    });
                });
                
                // Home page action cards
                this.elements.actionCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const action = card.dataset.action;
                        this.handleAction(action);
                        this.hapticFeedback();
                    });
                });
                
                // Meal planner buttons
                this.elements.generateListBtn.addEventListener('click', () => this.generateShoppingList());
                this.elements.clearDayBtn.addEventListener('click', () => this.clearCurrentDay());
                this.elements.prevWeekBtn.addEventListener('click', () => this.changeWeek(-1));
                this.elements.nextWeekBtn.addEventListener('click', () => this.changeWeek(1));
                
                // Meal slot clicks
                Object.entries(this.elements.mealSlots).forEach(([type, slot]) => {
                    slot.addEventListener('click', () => this.openMealSelection(type));
                });
                
                // Modal events
                this.elements.closeModalBtn.addEventListener('click', () => this.closeModal());
                this.elements.backdrop.addEventListener('click', () => this.closeModal());
                
                // Category selection
                this.elements.mealCategories.addEventListener('click', (e) => {
                    const categoryCard = e.target.closest('.category-card');
                    if (categoryCard) {
                        const category = categoryCard.dataset.category;
                        this.selectCategory(category);
                    }
                });
                
                // Shopping list events
                this.elements.closeListBtn.addEventListener('click', () => this.closeShoppingList());
                this.elements.clearListBtn.addEventListener('click', () => this.clearShoppingList());
                this.elements.saveListBtn.addEventListener('click', () => this.saveShoppingList());
                
                // Header buttons
                this.elements.notificationBtn.addEventListener('click', () => this.showNotification("3 items expiring tomorrow!", "warning"));
                this.elements.scanBtn.addEventListener('click', () => this.navigateTo('scanner'));
                
                // Scanner events
                this.elements.startScanBtn.addEventListener('click', () => this.scanner.startScanning());
                this.elements.stopScanBtn.addEventListener('click', () => this.scanner.stopScanning());
                
                // View all button
                document.querySelector('.view-all-btn').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.navigateTo('pantry');
                    this.hapticFeedback();
                });
                
                // Category tabs
                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        this.filterPantryItems(tab.textContent);
                        this.hapticFeedback();
                    });
                });
                
                // Recipe filters
                document.querySelectorAll('.filter-chip').forEach(filter => {
                    filter.addEventListener('click', () => {
                        document.querySelectorAll('.filter-chip').forEach(f => f.classList.remove('active'));
                        filter.classList.add('active');
                        this.filterRecipes(filter.textContent);
                        this.hapticFeedback();
                    });
                });
                
                // Training items
                document.querySelectorAll('.training-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const training = item.dataset.training;
                        this.startTraining(training);
                        this.hapticFeedback();
                    });
                });
            }
            
            setupMockData() {
                // Add some default pantry items
                if (appState.pantryItems.length === 0) {
                    appState.pantryItems = [
                        { name: "Eggs", quantity: 12, category: "Dairy", emoji: "ü•ö", addedDate: "2024-01-15", expiryDate: "2024-02-12", status: "fresh" },
                        { name: "Milk", quantity: 1, category: "Dairy", emoji: "ü•õ", addedDate: "2024-01-18", expiryDate: "2024-01-25", status: "warning" },
                        { name: "Tomatoes", quantity: 5, category: "Produce", emoji: "üçÖ", addedDate: "2024-01-17", expiryDate: "2024-01-24", status: "warning" },
                        { name: "Rice", quantity: 5, category: "Grains", emoji: "üçö", addedDate: "2024-01-01", expiryDate: "2024-07-01", status: "fresh" },
                        { name: "Avocado", quantity: 2, category: "Fruit", emoji: "ü•ë", addedDate: "2024-01-19", expiryDate: "2024-01-24", status: "warning" }
                    ];
                    this.updatePantryGrid();
                    this.scanner.updatePantryStats();
                }
                
                // Pre-fill meal plan for demo
                const today = new Date();
                const dayKey = `week0_day${today.getDay() || 1}`;
                
                if (!appState.mealPlan[dayKey]) {
                    appState.mealPlan[dayKey] = {
                        breakfast: mealDatabase.meals[0],
                        lunch: mealDatabase.meals[2],
                        dinner: mealDatabase.meals[4]
                    };
                    this.saveMealPlan();
                }
                
                this.loadDayMeals();
            }
            
            loadPantryItems() {
                const saved = localStorage.getItem('darsnest_pantry');
                if (saved) {
                    appState.pantryItems = JSON.parse(saved);
                    this.updatePantryGrid();
                }
            }
            
            savePantryItems() {
                localStorage.setItem('darsnest_pantry', JSON.stringify(appState.pantryItems));
            }
            
            updatePantryGrid() {
                const grid = this.elements.pantryGrid;
                if (!grid) return;
                
                grid.innerHTML = '';
                
                appState.pantryItems.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = `pantry-card glass-effect pantry-card-${item.status}`;
                    
                    // Calculate days until expiry
                    const expiryDate = new Date(item.expiryDate);
                    const today = new Date();
                    const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
                    
                    let statusClass = 'status-fresh';
                    if (daysUntilExpiry <= 0) statusClass = 'status-expired';
                    else if (daysUntilExpiry <= 3) statusClass = 'status-warning';
                    
                    card.innerHTML = `
                        <div class="item-status ${statusClass}"></div>
                        <div class="item-image">${item.emoji}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-details">${item.category} ¬∑ ${item.quantity} ${item.quantity === 1 ? 'piece' : 'pieces'}</div>
                        <div class="item-details">${daysUntilExpiry > 0 ? `Expires in ${daysUntilExpiry} days` : 'Expired'}</div>
                        <div class="item-quantity">
                            <button class="quantity-btn minus" data-index="${index}">-</button>
                            <span id="quantity-${index}">${item.quantity}</span>
                            <button class="quantity-btn plus" data-index="${index}">+</button>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
                
                // Add quantity button events
                document.querySelectorAll('.quantity-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.dataset.index);
                        const isPlus = e.target.classList.contains('plus');
                        
                        if (!isNaN(index)) {
                            if (isPlus) {
                                appState.pantryItems[index].quantity += 1;
                            } else if (appState.pantryItems[index].quantity > 1) {
                                appState.pantryItems[index].quantity -= 1;
                            }
                            
                            document.getElementById(`quantity-${index}`).textContent = appState.pantryItems[index].quantity;
                            this.savePantryItems();
                            this.scanner.updatePantryStats();
                            this.hapticFeedback();
                        }
                    });
                });
            }
            
            filterPantryItems(category) {
                // Implementation for filtering pantry items
                console.log(`Filtering by: ${category}`);
            }
            
            loadRecipes() {
                const grid = this.elements.recipeGrid;
                if (!grid) return;
                
                grid.innerHTML = '';
                
                recipeDatabase.forEach(recipe => {
                    const card = document.createElement('div');
                    card.className = 'recipe-card glass-effect';
                    card.dataset.recipeId = recipe.id;
                    
                    card.innerHTML = `
                        <div class="recipe-image">
                            ${recipe.image}
                            <div class="recipe-time"><i class="fas fa-clock"></i> ${recipe.time}m</div>
                        </div>
                        <div class="recipe-title">${recipe.name}</div>
                        <div class="recipe-stats">
                            <span>üî• ${recipe.calories} cal</span>
                            <span>‚≠ê ${recipe.rating}</span>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        this.showRecipeDetail(recipe);
                        this.hapticFeedback();
                    });
                    
                    grid.appendChild(card);
                });
            }
            
            filterRecipes(filter) {
                // Implementation for filtering recipes
                console.log(`Filtering recipes by: ${filter}`);
            }
            
            showRecipeDetail(recipe) {
                // Create recipe detail modal
                const modal = document.createElement('div');
                modal.className = 'recipe-modal active';
                modal.innerHTML = `
                    <div class="recipe-modal-header">
                        <button class="recipe-modal-close">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="recipe-modal-image">${recipe.image}</div>
                        <h1>${recipe.name}</h1>
                        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 12px;">
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.2rem;">${recipe.time}m</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Prep Time</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.2rem;">${recipe.calories}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Calories</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; font-size: 1.2rem;">${recipe.difficulty}</div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Difficulty</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipe-modal-content">
                        <div class="recipe-section">
                            <div class="section-title">Ingredients</div>
                            <div class="ingredient-list">
                                ${recipe.ingredients.map(ing => `
                                    <div class="ingredient-item">
                                        <i class="fas fa-circle" style="font-size: 8px; margin-right: 12px; color: #22c55e;"></i>
                                        ${ing}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="recipe-section">
                            <div class="section-title">Preparation Steps</div>
                            <div class="step-list">
                                ${recipe.steps.map((step, idx) => `
                                    <div class="step-item">
                                        <div style="width: 24px; height: 24px; border-radius: 12px; background: var(--primary-gradient); color: white; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-weight: 700; font-size: 0.9rem;">
                                            ${idx + 1}
                                        </div>
                                        ${step}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="action-buttons" style="margin-top: 40px;">
                            <button class="btn btn-secondary" id="addToMealPlan">
                                <i class="fas fa-calendar-plus"></i>
                                Add to Meal Plan
                            </button>
                            <button class="btn btn-primary" id="startCooking">
                                <i class="fas fa-utensils"></i>
                                Start Cooking
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                this.elements.backdrop.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Add event listeners
                modal.querySelector('.recipe-modal-close').addEventListener('click', () => {
                    modal.remove();
                    this.elements.backdrop.classList.remove('active');
                    document.body.style.overflow = '';
                });
                
                modal.querySelector('#addToMealPlan').addEventListener('click', () => {
                    this.showNotification(`${recipe.name} added to meal plan!`, 'success');
                    modal.remove();
                    this.elements.backdrop.classList.remove('active');
                    document.body.style.overflow = '';
                });
                
                modal.querySelector('#startCooking').addEventListener('click', () => {
                    this.showNotification(`Starting ${recipe.name} recipe! üç≥`, 'success');
                    modal.remove();
                    this.elements.backdrop.classList.remove('active');
                    document.body.style.overflow = '';
                });
            }
            
            setupDays() {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const today = new Date();
                
                let startDate = new Date(today);
                startDate.setDate(today.getDate() - today.getDay() + 1 + (appState.currentWeek * 7));
                
                this.elements.daysGrid.innerHTML = '';
                
                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(startDate.getDate() + i);
                    
                    const dayCard = document.createElement('div');
                    dayCard.className = `day-card glass-effect ${i === appState.selectedDay - 1 ? 'active' : ''}`;
                    dayCard.dataset.dayIndex = i;
                    
                    const dayName = days[(currentDate.getDay())];
                    const dayNumber = currentDate.getDate();
                    
                    dayCard.innerHTML = `
                        <div class="day-name">${dayName}</div>
                        <div class="day-number">${dayNumber}</div>
                    `;
                    
                    dayCard.addEventListener('click', () => {
                        this.selectDay(i);
                        this.hapticFeedback();
                    });
                    
                    this.elements.daysGrid.appendChild(dayCard);
                }
                
                // Update week title
                const weekTitle = document.querySelector('.week-title');
                if (appState.currentWeek === 0) {
                    weekTitle.textContent = 'This Week';
                } else if (appState.currentWeek === 1) {
                    weekTitle.textContent = 'Next Week';
                } else if (appState.currentWeek === -1) {
                    weekTitle.textContent = 'Last Week';
                } else {
                    weekTitle.textContent = `Week ${appState.currentWeek > 0 ? '+' : ''}${appState.currentWeek}`;
                }
            }
            
            selectDay(dayIndex) {
                document.querySelectorAll('.day-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                const selectedCard = document.querySelector(`[data-day-index="${dayIndex}"]`);
                if (selectedCard) {
                    selectedCard.classList.add('active');
                }
                
                appState.selectedDay = dayIndex + 1;
                this.loadDayMeals();
            }
            
            loadDayMeals() {
                const dayKey = this.getDayKey();
                const dayMeals = appState.mealPlan[dayKey] || {};
                
                ['breakfast', 'lunch', 'dinner'].forEach(type => {
                    const slot = this.elements.mealSlots[type];
                    const meal = dayMeals[type];
                    
                    if (meal) {
                        slot.classList.add('has-meal');
                        slot.innerHTML = `
                            <div class="meal-preview">
                                <div class="meal-preview-icon">${meal.icon}</div>
                                <div class="meal-preview-info">
                                    <div class="meal-preview-name">${meal.name}</div>
                                    <div class="meal-preview-details">
                                        <span>üïê ${meal.time} min</span>
                                        <span>üî• ${meal.calories} cal</span>
                                        <span>$${meal.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        slot.classList.remove('has-meal');
                        slot.innerHTML = '<div class="empty-slot-text">Select ' + type.charAt(0).toUpperCase() + type.slice(1) + '</div>';
                    }
                });
            }
            
            getDayKey() {
                return `week${appState.currentWeek}_day${appState.selectedDay}`;
            }
            
            loadMealPlan() {
                const savedPlan = localStorage.getItem('darsnest_meal_plan');
                if (savedPlan) {
                    appState.mealPlan = JSON.parse(savedPlan);
                }
                this.updateBadge();
            }
            
            saveMealPlan() {
                localStorage.setItem('darsnest_meal_plan', JSON.stringify(appState.mealPlan));
                this.updateBadge();
            }
            
            updateBadge() {
                let totalMeals = 0;
                Object.values(appState.mealPlan).forEach(day => {
                    totalMeals += Object.keys(day).length;
                });
                
                const badge = this.elements.mealPlanBadge;
                badge.textContent = totalMeals;
                badge.style.display = totalMeals === 0 ? 'none' : 'flex';
            }
            
            navigateTo(page) {
                if (appState.currentPage === page) return;
                
                // Stop scanner if leaving scanner page
                if (appState.currentPage === 'scanner' && page !== 'scanner') {
                    this.scanner.stopScanning();
                }
                
                appState.currentPage = page;
                
                // Update tabs
                this.elements.tabs.forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.page === page);
                });
                
                // Update pages
                Object.keys(this.elements.pages).forEach(pageKey => {
                    const pageElement = this.elements.pages[pageKey];
                    if (pageKey === page) {
                        pageElement.classList.add('active');
                    } else {
                        pageElement.classList.remove('active');
                    }
                });
                
                // Special handling for scanner page
                if (page === 'scanner') {
                    // Initialize scanner when page loads
                    setTimeout(() => this.scanner.init(), 500);
                }
            }
            
            handleAction(action) {
                switch(action) {
                    case 'scan':
                        this.navigateTo('scanner');
                        break;
                    case 'train':
                        this.navigateTo('training');
                        break;
                    case 'recipes':
                        this.navigateTo('recipes');
                        break;
                    case 'shopping':
                        this.generateShoppingList();
                        break;
                }
            }
            
            openMealSelection(mealType) {
                appState.selectedMealType = mealType;
                appState.selectedCategory = 'all';
                
                this.elements.modalTitle.textContent = `Select ${mealType.charAt(0).toUpperCase() + mealType.slice(1)}`;
                
                document.querySelectorAll('.category-card').forEach(card => {
                    card.classList.remove('active');
                    if (card.dataset.category === 'all') {
                        card.classList.add('active');
                    }
                });
                
                this.renderMeals();
                this.elements.mealModal.classList.add('active');
                this.elements.backdrop.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeModal() {
                this.elements.mealModal.classList.remove('active');
                this.elements.backdrop.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            selectCategory(category) {
                document.querySelectorAll('.category-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                const selectedCard = document.querySelector(`[data-category="${category}"]`);
                if (selectedCard) {
                    selectedCard.classList.add('active');
                }
                
                appState.selectedCategory = category;
                this.renderMeals();
            }
            
            renderMeals() {
                const mealList = this.elements.mealList;
                if (!mealList) return;
                
                mealList.innerHTML = '';
                
                let filteredMeals = mealDatabase.meals.filter(meal => 
                    meal.type === appState.selectedMealType
                );
                
                if (appState.selectedCategory !== 'all') {
                    filteredMeals = filteredMeals.filter(meal => 
                        meal.category === appState.selectedCategory ||
                        meal.tags.includes(appState.selectedCategory)
                    );
                }
                
                filteredMeals.forEach(meal => {
                    const mealOption = document.createElement('div');
                    mealOption.className = 'meal-option glass-effect';
                    mealOption.dataset.mealId = meal.id;
                    
                    const tagsHtml = meal.tags.map(tag => 
                        `<span class="meal-tag">${tag}</span>`
                    ).join('');
                    
                    mealOption.innerHTML = `
                        <div class="meal-option-icon">${meal.icon}</div>
                        <div class="meal-option-info">
                            <div class="meal-option-name">${meal.name}</div>
                            <div class="meal-option-details">
                                ‚≠ê 4.5 | üïê ${meal.time} min | üî• ${meal.calories} cal
                            </div>
                            <div class="meal-option-tags">${tagsHtml}</div>
                        </div>
                        <div class="meal-option-price">$${meal.price.toFixed(2)}</div>
                    `;
                    
                    mealOption.addEventListener('click', () => {
                        this.selectMeal(meal);
                        this.hapticFeedback();
                    });
                    
                    mealList.appendChild(mealOption);
                });
            }
            
            selectMeal(meal) {
                const dayKey = this.getDayKey();
                
                if (!appState.mealPlan[dayKey]) {
                    appState.mealPlan[dayKey] = {};
                }
                
                appState.mealPlan[dayKey][appState.selectedMealType] = meal;
                this.saveMealPlan();
                this.loadDayMeals();
                this.closeModal();
                this.showNotification(`${meal.name} added to ${appState.selectedMealType}!`, 'success');
            }
            
            clearCurrentDay() {
                const dayKey = this.getDayKey();
                
                if (appState.mealPlan[dayKey]) {
                    delete appState.mealPlan[dayKey];
                    this.saveMealPlan();
                    this.loadDayMeals();
                    this.showNotification('Day cleared!', 'info');
                } else {
                    this.showNotification('No meals to clear', 'info');
                }
            }
            
            changeWeek(delta) {
                appState.currentWeek += delta;
                this.setupDays();
                this.loadDayMeals();
                this.hapticFeedback();
            }
            
            generateShoppingList() {
                const allIngredients = [];
                const ingredientMap = new Map();
                
                Object.values(appState.mealPlan).forEach(day => {
                    Object.values(day).forEach(meal => {
                        meal.ingredients.forEach(ingredient => {
                            const existing = ingredientMap.get(ingredient.name);
                            
                            if (existing) {
                                existing.quantity = this.mergeQuantities(existing.quantity, ingredient.quantity);
                                existing.totalPrice += ingredient.price;
                            } else {
                                const item = {
                                    ...ingredient,
                                    totalPrice: ingredient.price,
                                    checked: false,
                                    id: Math.random().toString(36).substr(2, 9)
                                };
                                ingredientMap.set(ingredient.name, item);
                                allIngredients.push(item);
                            }
                        });
                    });
                });
                
                if (allIngredients.length === 0) {
                    this.showNotification('No meals in your plan yet!', 'info');
                    return;
                }
                
                appState.shoppingList = allIngredients;
                appState.selectedItems.clear();
                appState.totalCost = allIngredients.reduce((sum, item) => sum + item.totalPrice, 0);
                
                this.renderShoppingList();
                this.openShoppingList();
                this.showNotification('Shopping list generated!', 'success');
            }
            
            mergeQuantities(qty1, qty2) {
                return `${qty1} + ${qty2}`;
            }
            
            renderShoppingList() {
                const container = this.elements.shoppingListItems;
                const totalCostElement = this.elements.totalCost;
                
                totalCostElement.textContent = `$${appState.totalCost.toFixed(2)}`;
                container.innerHTML = '';
                
                appState.shoppingList.forEach((item) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item glass-effect';
                    listItem.dataset.itemId = item.id;
                    
                    const isChecked = appState.selectedItems.has(item.id);
                    
                    listItem.innerHTML = `
                        <div class="item-check ${isChecked ? 'checked' : ''}" data-item-id="${item.id}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="item-info">
                            <div class="item-name">${item.name}</div>
                            <div class="item-details">
                                <span class="item-quantity">${item.quantity}</span>
                                <span class="item-price">$${item.totalPrice.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(listItem);
                });
                
                container.addEventListener('click', (e) => {
                    const itemCheck = e.target.closest('.item-check');
                    if (itemCheck) {
                        const itemId = itemCheck.dataset.itemId;
                        this.toggleShoppingListItem(itemId);
                    }
                });
            }
            
            toggleShoppingListItem(itemId) {
                if (appState.selectedItems.has(itemId)) {
                    appState.selectedItems.delete(itemId);
                } else {
                    appState.selectedItems.add(itemId);
                }
                
                const itemCheck = document.querySelector(`.item-check[data-item-id="${itemId}"]`);
                if (itemCheck) {
                    itemCheck.classList.toggle('checked');
                }
                
                this.hapticFeedback();
            }
            
            openShoppingList() {
                this.elements.shoppingListPanel.classList.add('active');
                this.elements.backdrop.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeShoppingList() {
                this.elements.shoppingListPanel.classList.remove('active');
                this.elements.backdrop.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            clearShoppingList() {
                appState.shoppingList = [];
                appState.selectedItems.clear();
                appState.totalCost = 0;
                
                this.closeShoppingList();
                this.showNotification('Shopping list cleared!', 'info');
            }
            
            saveShoppingList() {
                const listData = {
                    date: new Date().toISOString(),
                    items: appState.shoppingList,
                    totalCost: appState.totalCost
                };
                
                localStorage.setItem('darsnest_shopping_list', JSON.stringify(listData));
                this.showNotification('Shopping list saved!', 'success');
            }
            
            startTraining(trainingType) {
                const trainingNames = {
                    identify: "Identify Items",
                    verify: "Verify Scans",
                    categorize: "Categorize Foods",
                    expiry: "Expiry Detection"
                };
                
                this.showNotification(`Starting ${trainingNames[trainingType]} training!`, 'info');
                
                // Simulate training progress
                setTimeout(() => {
                    const progressValue = document.querySelector('.progress-value');
                    const progressFill = document.querySelector('.progress-fill');
                    
                    if (progressValue && progressFill) {
                        const currentProgress = parseInt(progressValue.textContent);
                        const newProgress = Math.min(currentProgress + 2, 100);
                        
                        progressValue.textContent = `${newProgress}%`;
                        progressFill.style.width = `${newProgress}%`;
                        
                        this.showNotification(`Training complete! AI accuracy improved to ${newProgress}%`, 'success');
                    }
                }, 3000);
            }
            
            showNotification(message, type = 'info') {
                this.scanner.showNotification(message, type);
            }
            
            hapticFeedback() {
                this.scanner.hapticFeedback();
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new DarsNestApp();
            
            // Set initial day
            const today = new Date().getDay();
            appState.selectedDay = today === 0 ? 1 : today;
            
            setTimeout(() => {
                const dayIndex = appState.selectedDay - 1;
                const dayCard = document.querySelector(`[data-day-index="${dayIndex}"]`);
                if (dayCard) {
                    document.querySelectorAll('.day-card').forEach(card => card.classList.remove('active'));
                    dayCard.classList.add('active');
                }
                window.app.loadDayMeals();
            }, 100);
            
            // PWA Installation
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                
                setTimeout(() => {
                    window.app.showNotification('Install DarsNest as an app for better experience! üì±', 'info');
                }, 10000);
            });
        });
    </script>
</body>
</html>
